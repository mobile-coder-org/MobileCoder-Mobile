<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>CodeMirror: HTML5 preview</title>
<script src='http://codemirror.net/lib/codemirror.js'></script>
<script src='http://codemirror.net/mode/xml/xml.js'></script>
<script src='http://codemirror.net/mode/javascript/javascript.js'></script>
<script src='http://codemirror.net/mode/css/css.js'></script>
<script src='http://codemirror.net/mode/htmlmixed/htmlmixed.js'></script>
<script src='http://codemirror.net/addon/edit/closebrackets.js'></script>
<link rel='stylesheet' href='http://codemirror.net/lib/codemirror.css'>
<link rel='stylesheet' href='http://codemirror.net/doc/docs.css'>
<link href="http://codemirror.net/theme/darcula.css" rel="stylesheet" />
<style type='text/css'>
.CodeMirror {
    float: left;
    width: 100%;
    height: 80%;
    font-size: 35px;
    border: 1px solid black;}

/* iframe {
    width: 100%;
    float: left;
    height: 300px;
    border: 1px solid black;
    border-left: 0px;} */
.saveAndLoad {
    font-size: 35px;
}

</style>
</head>
<body>
<textarea id="code" name="code">
</textarea>

    <!-- <iframe id="preview"></iframe> -->
    <label for="file" size="10">Choose a file to work with:</label>
    <input type="file" id="file" onchange="loadfile(this)" class="saveAndLoad" size="10">
    <a href="#my-header" onclick='saveTextAsFile()' class="saveAndLoad">Save/Download</a>

<script>
    var delay;

    // Initialize CodeMirror editor
    var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        mode: 'javascript',
        // tabMode: 'indent',
        lineNumbers: true,
        lineWrapping: true,
        theme: "darcula",
        autoCloseBrackets: true,
        // autoCloseTags: true
    });

    // Live preview
    editor.on("change", function() {
        clearTimeout(delay);
        delay = setTimeout(updatePreview, 300);
    });
    setTimeout(updatePreview, 300);

    function saveTextAsFile() {
        var textToWrite = document.getElementById("code").value;
        //somehow push the variable "textToWrite" to the firebase 
    }

    function destroyClickedElement(event) {
        document.body.removeChild(event.target);}

    function loadfile(input){
        var reader = new FileReader();
        reader.onload = function(e) {
            editor.setValue(e.target.result);}
        reader.readAsText(input.files[0]);}

        var input = document.getElementById("select");

        function selectTheme() {
        var theme = input.options[input.selectedIndex].innerHTML;
        editor.setOption("theme", theme);
        }

        var choice = document.location.search &&
                decodeURIComponent(document.location.search.slice(1));
        if (choice) {
        input.value = choice;
        editor.setOption("theme", choice);
        }
</script>
</body>
</html>